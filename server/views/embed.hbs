<html lang="en">
   <head>
   <meta charset="utf-8">
   <title></title>
   <!-- CSS --> 
   <style>
      body {
         margin: 0;
      }
      .embedlam-overlay{
        position: absolute;
        visibility: visible;
        top: 0;
        left: 0;
        background-color: #757575;
        height: 100%;
        width: 100%;
      }
      .embedlam-spinner {
        position: relative;
        top: 50%;
        transform: translateY(-50%);
      }
      .embedlam-loader {
        margin: 0 auto;
        font-size: 10px;
        position: relative;
        text-indent: -9999em;
        border-top: 1.1em solid rgba(255, 255, 255, 0.2);
        border-right: 1.1em solid rgba(255, 255, 255, 0.2);
        border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
        border-left: 1.1em solid #ffffff;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-animation: load8 1.1s infinite linear;
        animation: load8 1.1s infinite linear;
      }
      .embedlam-loader,
      .embedlam-loader:after {
        border-radius: 50%;
        width: 10em;
        height: 10em;
      }
      @-webkit-keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      @keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
   </style>
   <body>
      <!-- FRAME --> 
      <div style="position: relative; width: 100%; height: 100%">
         <div id="cyclopse-overlay" class="embedlam-overlay">
               <div class="embedlam-spinner">
                  <div class="embedlam-loader"></div>
               </div>
            </div>
         <div id="cyclopse-youtube-player"></div>
      </div>
      <!-- CODE -->
      <script>
         
         function cyclopse_loader(){

            var tag, firstScriptTag, player, loop, quality, mute, rate, start, end, init, overlay, timer;

            // Options & Overlay
            loop = {{video.loop}};
            quality = "{{video.quality}}";
            autoplay = {{ video.autoplay }};
            mute =  {{ video.mute }};
            rate = {{ video.rate }};
            start = {{ video.start }};
            end = {{ video.end }};
            init = true; 
            overlay = document.getElementById('cyclopse-overlay');

            // Load YT Player API
            tag = document.createElement("script");          
            tag.src = (("http:" === document.location.protocol) ? "http:" : "https:") + "//www.youtube.com/iframe_api"; 
            firstScriptTag = document.getElementById('cyclopse-youtube-player');    
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);          
            
            // Main
            window.onYouTubeIframeAPIReady = function(){ loadPlayer(); }

            // Player instance
            function loadPlayer(){
               embdebug = player = new YT.Player('cyclopse-youtube-player', {
                  width: {{ video.width }},
                  height: {{ video.height }},
                  videoId: "{{video.videoId}}",
                  playerVars: {
                     'iv_load_policy':  {{ video.iv_load_policy }},
                     'controls' : {{video.controls}},
                     'disablekb': {{video.disablekb}},
                     'fs' : {{video.fs}},
                     'modestbranding' : {{video.modestbranding}},
                     'showinfo' : {{video.showinfo}}
                  },
                  events: {
                     onReady: onPlayerReady, 
                     onStateChange: onPlayerStateChange, 
                     onError: onPlayerError 
                  } 
               }); 
            }; 
      
            // Timing - setStop(), killStop(), getOffset()
            // See client/scripts/services/ytplayerAPI.js 
            function setStop(){
  
               var ms = timeoutLength();
               
               timer = setTimeout(function(){
                   
                  (!loop) ? 
                    player.pauseVideo() : 
                    player.seekTo(start); 
                  
                  killStop();

               }, ms);
            };

            function killStop(){
              clearTimeout(timer);
            }

            function timeoutLength(){
              var ms = Math.floor( (end - player.getCurrentTime()) * 1000 );

              if (rate == 0.5) return (ms * 2);
              if (rate == 1 ) return (ms);
              if (rate == 1.5) return Math.floor(ms * .66);

              return ms; 
            }

            // YT Player callbacks
            function onPlayerReady(){
               player.mute();
               player.seekTo(start);
               player.playVideo();
            };

            function onPlayerStateChange(event){
               if (event.data === YT.PlayerState.PLAYING){
                  setStop();
                  if (init){

                    init = false;
                    player.pauseVideo();
                    player.seekTo(start);
                    
                    (rate != 1) ? 
                      player.setPlaybackRate(rate) : 
                      false;
                    
                    (autoplay) ? 
                      player.playVideo() : 
                      player.pauseVideo();
                     
                    
                    setTimeout(function(){
                      overlay.style.visibility = "hidden";
                      
                      (!mute) ? 
                        player.unMute(): 
                        false;
                     
                    }, 250);
                  }
               } else {
                 killStop();
               }
            };
            function onPlayerError(){ console.error("Cyclop.se v YouTube.com: 0-1"); };
         };
         
         // Do it. 
         cyclopse_loader();

      </script>
   </body>
</html>